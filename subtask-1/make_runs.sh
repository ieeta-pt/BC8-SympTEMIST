

while read -r line
do
  echo "Inference for $line"
  #need to force to 1 GPU bc the he did not implemented a multiGPU-CRF 
  CUDA_VISIBLE_DEVICES="0" python ner_inference.py --checkpoint T-Almeida/MedProcNER --revision $line  --testset_folder ../dataset/medprocner_test/txt --out_folder runs
done < "hub_models.txt"

echo "Make run 0 - ensemble"
python ensemble_inference.py runs/lcampillos-dense-8-ukn-0.05-1-roberta-es-ner-trainer-v5-checkpoint-4400.json runs/lcampillos-dense-8-ukn-0.05-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-1235-roberta-es-ner-trainer-v5-checkpoint-4480.json runs/lcampillos-dense-8-ukn-0.05-3407-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-7534-roberta-es-ner-trainer-v5-checkpoint-4440.json --out ensemble_runs/run0.json

echo "Make run 1 - ensemble"
python ensemble_inference.py runs/lcampillos-dense-8-ukn-0.05-1-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-ukn-0.05-1235-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-ukn-0.05-3407-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-ukn-0.05-3407-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-ukn-0.05-7534-roberta-es-ner-trainer-full-v6-checkpoint-5200.json --out ensemble_runs/run1.json 

echo "Make run 2 - ensemble"
python ensemble_inference.py runs/lcampillos-bilstm-8-ukn-0.4-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-7534-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-bilstm-8-random-0.4-42-roberta-es-ner-trainer-v5-checkpoint-4218.json runs/lcampillos-bilstm-8-ukn-0.05-42-roberta-es-ner-trainer-v5-checkpoint-1776.json runs/lcampillos-bilstm-8-ukn-0.05-3407-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-bilstm-8-random-0.2-42-roberta-es-ner-trainer-v5-checkpoint-4107.json runs/lcampillos-bilstm-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-1776.json runs/lcampillos-bilstm-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-4218.json runs/lcampillos-bilstm-8-random-0.05-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-1235-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-bilstm-8-ukn-0.05-1-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-bilstm-8-ukn-0.05-7534-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-bilstm-8-ukn-0.05-5374-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-bilstm-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-random-0.4-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-bilstm-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-1776.json runs/lcampillos-bilstm-8-ukn-0.05-1235-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-bilstm-8-random-0.05-42-roberta-es-ner-trainer-v5-checkpoint-1776.json runs/lcampillos-bilstm-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-3219.json runs/lcampillos-bilstm-8-ukn-0.4-42-roberta-es-ner-trainer-v5-checkpoint-3219.json runs/lcampillos-bilstm-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-4107.json runs/lcampillos-bilstm-8-random-0.2-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-5374-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-bilstm-8-ukn-0.05-1-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-bilstm-8-ukn-0.05-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-3407-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-bilstm-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json --out ensemble_runs/run2.json

echo "Make run 3 - ensemble"
python ensemble_inference.py runs/PlanTL-GOB-ES-dense-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-2553.json runs/PlanTL-GOB-ES-dense-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-1776.json runs/PlanTL-GOB-ES-bilstm-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-dense-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-2775.json runs/PlanTL-GOB-ES-dense-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-bilstm-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-bilstm-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-3663.json runs/PlanTL-GOB-ES-bilstm-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-dense-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-999.json runs/PlanTL-GOB-ES-dense-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-dense-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-dense-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-bilstm-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-1332.json runs/PlanTL-GOB-ES-dense-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-777.json runs/PlanTL-GOB-ES-bilstm-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-bilstm-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-1665.json runs/PlanTL-GOB-ES-bilstm-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-2442.json runs/PlanTL-GOB-ES-dense-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-bilstm-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-777.json runs/PlanTL-GOB-ES-bilstm-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json --out ensemble_runs/run3.json

echo "Make run 4 - ensemble"
python ensemble_inference.py runs/lcampillos-bilstm-8-ukn-0.4-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-7534-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-ukn-0.05-1-roberta-es-ner-trainer-v5-checkpoint-4400.json runs/lcampillos-dense-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-1110.json runs/lcampillos-bilstm-8-random-0.4-42-roberta-es-ner-trainer-v5-checkpoint-4218.json runs/lcampillos-dense-8-ukn-0.05-7534-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-bilstm-8-ukn-0.05-42-roberta-es-ner-trainer-v5-checkpoint-1776.json runs/lcampillos-dense-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-1-roberta-es-ner-trainer-v5-checkpoint-2530.json runs/PlanTL-GOB-ES-dense-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-2553.json runs/lcampillos-dense-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-1665.json runs/PlanTL-GOB-ES-dense-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-1776.json runs/lcampillos-bilstm-8-ukn-0.05-3407-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-1332.json runs/PlanTL-GOB-ES-bilstm-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-dense-8-random-0.05-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-3407-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-1235-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-ukn-0.05-1-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-bilstm-8-random-0.2-42-roberta-es-ner-trainer-v5-checkpoint-4107.json runs/lcampillos-bilstm-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-1776.json runs/lcampillos-bilstm-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-4218.json runs/lcampillos-dense-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-dense-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-2775.json runs/PlanTL-GOB-ES-dense-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-random-0.05-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-3407-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-bilstm-8-ukn-0.05-1235-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-1110.json runs/lcampillos-dense-8-random-0.05-42-roberta-es-ner-trainer-v5-checkpoint-1332.json runs/lcampillos-bilstm-8-ukn-0.05-1-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/PlanTL-GOB-ES-bilstm-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-7534-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-dense-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-5374-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-bilstm-8-ukn-0.05-5374-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/PlanTL-GOB-ES-bilstm-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-3663.json runs/lcampillos-dense-8-ukn-0.05-3407-roberta-es-ner-trainer-v5-checkpoint-3330.json runs/lcampillos-dense-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-bilstm-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-dense-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-999.json runs/PlanTL-GOB-ES-dense-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-dense-2-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-2398.json runs/PlanTL-GOB-ES-dense-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-random-0.4-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-bilstm-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-1776.json runs/lcampillos-bilstm-8-ukn-0.05-1235-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-bilstm-8-random-0.05-42-roberta-es-ner-trainer-v5-checkpoint-1776.json runs/lcampillos-dense-8-ukn-0.4-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-42-roberta-es-ner-trainer-v5-checkpoint-1110.json runs/lcampillos-dense-8-ukn-0.05-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/PlanTL-GOB-ES-dense-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-3219.json runs/PlanTL-GOB-ES-bilstm-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-1332.json runs/lcampillos-dense-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-1235-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-dense-8-ukn-0.05-1235-roberta-es-ner-trainer-v5-checkpoint-4480.json runs/PlanTL-GOB-ES-dense-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-777.json runs/lcampillos-dense-8-ukn-0.4-42-roberta-es-ner-trainer-v5-checkpoint-1110.json runs/lcampillos-bilstm-8-ukn-0.4-42-roberta-es-ner-trainer-v5-checkpoint-3219.json runs/lcampillos-dense-8-ukn-0.05-3407-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-ukn-0.05-7534-roberta-es-ner-trainer-v5-checkpoint-3996.json runs/lcampillos-dense-8-ukn-0.05-5374-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/PlanTL-GOB-ES-bilstm-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-bilstm-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/PlanTL-GOB-ES-bilstm-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-1665.json runs/lcampillos-dense-8-random-0.4-42-roberta-es-ner-trainer-v5-checkpoint-3441.json runs/lcampillos-dense-2-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-4360.json runs/lcampillos-bilstm-8-random-0.2-roberta-es-ner-trainer-v2-checkpoint-4107.json runs/PlanTL-GOB-ES-bilstm-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-2442.json runs/lcampillos-bilstm-8-random-0.2-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-7534-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/PlanTL-GOB-ES-dense-8-random-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-7534-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-random-0.2-42-roberta-es-ner-trainer-v5-checkpoint-1665.json runs/PlanTL-GOB-ES-bilstm-8-ukn-0.4-roberta-es-ner-trainer-v2-checkpoint-777.json runs/lcampillos-bilstm-8-ukn-0.05-5374-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/PlanTL-GOB-ES-bilstm-8-ukn-0.05-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-1-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-bilstm-8-ukn-0.05-1-roberta-es-ner-trainer-full-v6-checkpoint-5200.json runs/lcampillos-dense-8-random-0.4-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-ukn-0.05-1235-roberta-es-ner-trainer-v5-checkpoint-3024.json runs/lcampillos-bilstm-8-ukn-0.05-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-bilstm-8-ukn-0.05-3407-roberta-es-ner-trainer-full-v6-checkpoint-5070.json runs/lcampillos-bilstm-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-4440.json runs/lcampillos-dense-8-random-0.2-42-roberta-es-ner-trainer-v5-checkpoint-4440.json runs/lcampillos-dense-8-random-0.4-roberta-es-ner-trainer-v2-checkpoint-3441.json --out ensemble_runs/run4.json

python convert_ner_to_csv_format.py ensemble_runs/run0.json --output_folder ../medprocner-submission/subtask1
python convert_ner_to_csv_format.py ensemble_runs/run1.json --output_folder ../medprocner-submission/subtask1
python convert_ner_to_csv_format.py ensemble_runs/run2.json --output_folder ../medprocner-submission/subtask1
python convert_ner_to_csv_format.py ensemble_runs/run3.json --output_folder ../medprocner-submission/subtask1
python convert_ner_to_csv_format.py ensemble_runs/run4.json --output_folder ../medprocner-submission/subtask1
